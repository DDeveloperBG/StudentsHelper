window.addEventListener("load",()=>{function e(t,r){Twilio.Video.connect(r,{room:t,audio:!1,video:!0}).then(t=>{n(t.localParticipant);t.participants.forEach(n);t.on("participantConnected",n);t.on("participantDisconnected",o);window.addEventListener("beforeunload",i(t));window.addEventListener("pagehide",i(t))})}function n(n){const i=document.createElement("div");i.setAttribute("id",n.identity);r.appendChild(i);n.tracks.forEach(i=>{t(i,n)});n.on("trackPublished",t)}function t(n,t){const r=document.getElementById(t.identity),i=n=>{r.appendChild(n.attach())};n.track&&i(n.track);n.on("subscribed",i)}function o(n){n.removeAllListeners();const t=document.getElementById(n.identity);t.remove()}function i(n){return function(t){t.persisted||n&&(n.disconnect(),n=null)}}const r=document.getElementById("participants"),u=document.getElementById("username"),f=document.getElementById("room");fetch("/VideoChat/GetRoomAuthTocken",{method:"GET",headers:{"Content-Type":"application/json"}}).then(n=>n.json()).then({accessTocken:n,roomName:i,identity:t}=>{u.textContent=t,f.textContent=i,e(i,n)})});