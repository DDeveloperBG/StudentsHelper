function start(){function r(){let t=$("#messageInput").val();n.invoke("SendMessage",{Text:t,GroupId:i}).catch(function(n){return console.error(n.toString())});$("#messageInput").val("")}changeInitialTimesToMessages();const t=document.querySelector(".chat-messages");scrollToEnd(t);let n=(new signalR.HubConnectionBuilder).withUrl("/chatsocket").build();n.on("ReceiveMessage",displayMessage.bind(null,t));const i=document.getElementById("group-name").textContent;$("#sendButton").click(function(){r()});document.getElementById("messageInput").addEventListener("keypress",function(n){n.key==="Enter"&&r()});n.start().then(()=>{n.invoke("JoinGroup",i).catch(n=>console.error(n.toString()))}).catch(function(n){return console.error(n.toString())})}function scrollToEnd(n){n.scrollTo(0,n.scrollHeight)}function displayMessage(n,t){const i=document.getElementById("template").cloneNode(!0),f=document.getElementById("user-email").textContent,r=t.senderEmail==f;if(n.appendChild(i),!r){const n=window.location.href.indexOf(window.location.pathname),r=window.location.href.substring(0,n),u=`${r}/Chat/GetSenderProfilePicture?picturePath=${t.senderPicturePath??""}&email=${t.senderEmail}`;fetch(u).then(n=>n.text()).then(n=>{i.querySelector("#sender-picture").innerHTML=n}).catch(n=>{console.warn(n)})}i.querySelector("#message").textContent=escapeHtml(t.text);let e=r?"right":"left";i.classList.add(`chat-message-${e}`);const u=i.querySelector("#sending-time");u.textContent=t.sendTime;changeDomObjTimeToLocal(u);i.querySelector("#sender-name").textContent=r?"Вие":t.senderName;i.classList.remove("hidden");scrollToEnd(n)}function escapeHtml(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function changeInitialTimesToMessages(){Array.from(document.getElementsByClassName("send-time")).forEach(changeDomObjTimeToLocal)}function changeDomObjTimeToLocal(n){if(n.textContent!=""){const t=new moment(moment.utc(n.textContent).toDate());let i="DD.MM.YYYY г., HH:mm ч.";moment().isSame(t,"date")&&(i="HH:mm ч.");n.textContent=t.format(i)}}document.addEventListener("DOMContentLoaded",start);